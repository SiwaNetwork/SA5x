# SA5X Rubidium Generator Monitor

Программа мониторинга и тестирования рубидиевого генератора SA5X, основанная на проектах Time-Card и Timetickler.

## Возможности

### CLI Версия
- **Мониторинг в реальном времени**: Непрерывное отслеживание параметров SA5X
- **Тестирование holdover**: Автоматизированные тесты стабильности частоты
- **Анализ логов**: Парсинг и анализ существующих файлов логов
- **Конфигурация**: Гибкая настройка параметров через JSON файлы

### Web Версия
- **Веб-интерфейс**: Современный интерфейс с реальным временем
- **Интерактивные графики**: Визуализация данных с помощью Chart.js
- **Управление тестами**: Запуск и мониторинг тестов через браузер
- **Загрузка логов**: Анализ существующих файлов логов

## Установка

### Требования
- Python 3.8+
- Доступ к последовательному порту (для подключения к SA5X)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

## Использование

### CLI Версия

#### Базовое использование
```bash
# Показать текущий статус SA5X
python cli/main.py --port /dev/ttyUSB0

# Запустить мониторинг
python cli/main.py --port /dev/ttyUSB0 --monitor --interval 10

# Запустить тест holdover
python cli/main.py --port /dev/ttyUSB0 --holdover-test --duration 3600 --interval 10

# Анализ существующего лога
python cli/main.py --parse-log holdover_log.txt
```

#### Параметры командной строки
- `--port`: Последовательный порт для подключения
- `--baudrate`: Скорость передачи (по умолчанию: 115200)
- `--timeout`: Таймаут соединения (по умолчанию: 1.0)
- `--monitor`: Запустить непрерывный мониторинг
- `--holdover-test`: Запустить тест holdover
- `--duration`: Длительность теста в секундах (по умолчанию: 3600)
- `--interval`: Интервал измерений в секундах (по умолчанию: 10)
- `--output`: Файл для сохранения результатов
- `--parse-log`: Анализ существующего файла лога
- `--config`: Путь к файлу конфигурации
- `--verbose`: Подробный вывод

### Web Версия

#### Запуск веб-сервера
```bash
cd web
python app.py
```

Веб-интерфейс будет доступен по адресу: http://localhost:8080

#### Возможности веб-интерфейса
1. **Подключение**: Настройка параметров соединения с SA5X
2. **Мониторинг**: Запуск/остановка непрерывного мониторинга
3. **Тестирование**: Управление тестами holdover
4. **Визуализация**: Интерактивные графики в реальном времени
5. **Анализ логов**: Загрузка и анализ существующих файлов
6. **Конфигурация**: Управление настройками системы

## Структура проекта

```
sa5x_monitor/
├── cli/                    # CLI версия
│   └── main.py            # Основной CLI файл
├── web/                   # Web версия
│   ├── app.py            # Flask приложение
│   ├── templates/        # HTML шаблоны
│   └── static/           # Статические файлы (CSS, JS)
├── utils/                 # Общие утилиты
│   ├── sa5x_controller.py # Контроллер SA5X
│   ├── holdover_test.py  # Тестирование holdover
│   ├── log_parser.py     # Парсер логов
│   └── config_manager.py # Менеджер конфигурации
├── config/               # Конфигурационные файлы
├── tests/                # Тесты
├── requirements.txt      # Зависимости
└── README.md            # Документация
```

## Конфигурация

### Файл конфигурации
По умолчанию используется `config/sa5x_config.json`:

```json
{
  "serial": {
    "default_port": "/dev/ttyUSB0",
    "default_baudrate": 115200,
    "default_timeout": 1.0
  },
  "monitoring": {
    "default_interval": 10,
    "log_enabled": true
  },
  "holdover_test": {
    "min_duration": 300,
    "max_duration": 86400,
    "default_duration": 3600
  },
  "web_interface": {
    "host": "localhost",
    "port": 8080
  }
}
```

## Протокол связи с SA5X

Программа использует кастомный протокол связи с SA5X:

### Формат пакета
```
[START][LENGTH][COMMAND][DATA][CHECKSUM]
```

### Команды
- `0x01`: Получить статус
- `0x02`: Получить ошибку частоты
- `0x03`: Получить температуру
- `0x04`: Получить напряжение
- `0x05`: Получить ток
- `0x06`: Получить статус блокировки
- `0x07`: Получить статус holdover
- `0x08`: Запустить holdover
- `0x09`: Остановить holdover

## Анализ данных

### Метрики стабильности частоты
- **Стандартное отклонение**: Мера кратковременной стабильности
- **Дрейф частоты**: Линейный тренд изменения частоты
- **Отклонение Аллана**: Стандартная метрика стабильности частоты

### Метрики температуры
- **Стабильность температуры**: Стандартное отклонение температуры
- **Дрейф температуры**: Линейный тренд изменения температуры

## Примеры использования

### Тест holdover на 1 час
```bash
python cli/main.py --port /dev/ttyUSB0 --holdover-test --duration 3600 --interval 10 --output test_results.json
```

### Мониторинг с интервалом 5 секунд
```bash
python cli/main.py --port /dev/ttyUSB0 --monitor --interval 5
```

### Анализ существующего лога
```bash
python cli/main.py --parse-log holdover_test_20231201_143022.txt
```

## Разработка

### Запуск тестов
```bash
pytest tests/
```

### Форматирование кода
```bash
black sa5x_monitor/
flake8 sa5x_monitor/
```

## Лицензия

Проект основан на коде из:
- [Time-Card](https://github.com/Time-Appliances-Project/Time-Card)
- [Timetickler](https://github.com/Time-Appliances-Project/Time-Card/tree/master/OSC/Microchip/SA53)

## Поддержка

Для получения помощи или сообщения об ошибках, пожалуйста, создайте issue в репозитории проекта.